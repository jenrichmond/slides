---
title: "code along solutions"
author: "Jen Richmond"
date: "26/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 3 things I learned about lubridate

## 1. plotting with day(), wday(), month(), year()

### load packages
```{r}
library(tidyverse)
library(lubridate)
library(here)

options(scipen = 999) # i don't want scientific notation
```


### read data

Trick for young players--- there is a here() function in the lubridate package. If you are using lubridate and here together, specify here::here. 

```{r}
tests <- read_csv(here::here("data", "totaltests.csv"))
```

### glimpse

```{r}
glimpse(tests)
```

# Plotting with dates

## tests by date

```{r}
tests %>%
  ggplot(aes(x = test_date, y = total)) +
  geom_line()
```



## tests by month

```{r}
tests %>%
  ggplot(aes(x = month(test_date, label = TRUE), y = total, 
             fill = month(test_date, label = TRUE))) +
  geom_col() +
  scale_fill_brewer(palette = "Paired") +
  scale_y_continuous(limits = c(0, 800000), expand = c(0,0)) +
  labs(x = "Month", y = "Total tests") +
  theme_classic() +
  ggeasy::easy_remove_legend() 
```


## tests by wday

```{r}
tests %>%
  ggplot(aes(x = wday(test_date, week_start = getOption("lubridate.week.start", 1), label = TRUE), 
             y =total, 
             fill = wday(test_date, label = TRUE))) +
  geom_col() +
  scale_fill_brewer(palette = "Dark2") +
  scale_y_continuous(limits = c(0, 500000), expand = c(0,0)) +
  labs(x = "Day of the week", y = "Total tests") +
  theme_classic() +
  ggeasy::easy_remove_legend() 

```
# tests by day + month

```{r}
tests %>%
  filter(test_date >= "2020-07-01") %>%
  ggplot(aes(x = day(test_date), y = total, fill = wday(test_date, label = TRUE))) +
  geom_col() +
  scale_fill_brewer(palette = "Dark2") +
  scale_y_continuous(limits = c(0, 40000), expand = c(0,0)) +
  facet_wrap(~ month(test_date, label = TRUE)) +
   theme_classic() +
   labs(x = "Day of the month", y = "Total tests") 
```


### 2. converting characters to dates

Sometimes you get lucky and R recognises your dates as dates, and sometimes it doesn't

Tidy Tuesday Week X : Taylor Swift and Beyonce 

#### read the data 
```{r}
sales <- read_csv(here("data", "sales.csv"))
```
#### look at the class of the date variable

```{r}
class(sales$released)

sales$released[[1]]
```

The date data are characters but they are all in month, day, year format

#### convert to date using mdy()

```{r}
sales$released <- mdy(sales$released)

class(sales$released)

sales$released[[1]]

```

# plot sales by year/country

```{r}
sales %>%
  filter(country %in% c("US", "UK")) %>%
  ggplot(aes(x = year(released), y = sales, colour = country, group = country)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ artist) +
  theme_bw() +
  labs(y = "Total sales $", x = "Release year") 
  
```


### 3. how to make R read your dates as dates
